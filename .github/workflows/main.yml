name: Compile sketch (PSoC6)

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    tags: [ "*" ]
  pull_request:
  schedule:
    - cron: "30 3 * * 5" # every Friday 03:30 UTC

jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install Arduino CLI
        uses: arduino/setup-arduino-cli@v2

      - name: Configure Boards Manager URL (Infineon PSoC6) and install core
        run: |
          arduino-cli config init --overwrite
          arduino-cli config set board_manager.additional_urls \
            "https://github.com/Infineon/arduino-core-psoc6/releases/latest/download/package_psoc6_index.json"
          arduino-cli core update-index
          arduino-cli core install infineon:psoc6

      - name: Install libraries (NeoPixel + XENSIV BGT60)
        run: |
          arduino-cli lib update-index
          arduino-cli lib install "Adafruit NeoPixel"
          arduino-cli lib install "Xensiv BGT60"
          
      - name: Compile sketch
        run: |
          # Folder that contains your .ino:
          SKETCH_DIR="."

          # If this FQBN doesn't match your installed core, see the note below.
          FQBN="infineon:psoc6:cy8ckit_062s2_ai"

          arduino-cli compile --fqbn "$FQBN" "$SKETCH_DIR"
